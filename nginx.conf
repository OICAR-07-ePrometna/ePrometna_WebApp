# /etc/nginx/conf.d/default.conf

# Default server configuration
server {
  # Listen on port 80 for incoming connections
  listen 80;

  # Define the server name (optional, can be localhost or your domain)
  # server_name localhost;

  # Define the root directory for requests. This is where your Vue app's
  # built files (from the 'dist' folder) and config.json will be served from.
  root /usr/share/nginx/html;

  # Add index.html as the default file to serve
  index index.html;

  # Location block for serving the runtime configuration file
  # Ensures that config.json is served with no-cache headers to prevent
  # browsers from caching an old version if the container restarts with new env vars.
  location = /config.json {
    add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
    expires off;
    access_log off; # Optional: disable access logging for this specific file
    try_files $uri =404; # Serve the file if it exists, otherwise 404
  }

  # Standard location block for serving static files and handling SPA routing
  location / {
    # Try to serve the requested file directly.
    # If the file is not found, try to serve it as a directory.
    # If neither works, fall back to serving index.html.
    # This is crucial for Single Page Applications (SPAs) like Vue,
    # as it allows Vue Router to handle client-side routing.
    try_files $uri $uri/ /index.html;
  }

  # Optional: Add specific caching rules for static assets (JS, CSS, images, fonts)
  # These assets are typically fingerprinted by Vite, so they can be cached aggressively.
  location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y; # Cache for 1 year (or a duration appropriate for your deployment strategy)
    add_header Cache-Control "public, immutable";
    access_log off; # Optional: disable access logging for static assets
  }

  # Optional: Add gzip compression for text-based assets to reduce transfer size
  # gzip on;
  # gzip_vary on;
  # gzip_proxied any;
  # gzip_comp_level 6; # Compression level (1-9)
  # gzip_buffers 16 8k;
  # gzip_http_version 1.1;
  # gzip_min_length 256; # Don't compress files smaller than 256 bytes
  # gzip_types
  #   application/atom+xml
  #   application/geo+json
  #   application/javascript
  #   application/x-javascript
  #   application/json
  #   application/ld+json
  #   application/manifest+json
  #   application/rdf+xml
  #   application/rss+xml
  #   application/vnd.ms-fontobject
  #   application/wasm
  #   application/x-web-app-manifest+json
  #   application/xhtml+xml
  #   application/xml
  #   font/eot
  #   font/otf
  #   font/ttf
  #   image/svg+xml
  #   image/x-icon
  #   text/cache-manifest
  #   text/css
  #   text/javascript
  #   text/plain
  #   text/xml;

  # Optional: Error pages (customize as needed)
  # error_page 500 502 503 504 /50x.html;
  # location = /50x.html {
  #   root /usr/share/nginx/html; # Or a specific error pages directory
  # }

  # Optional: Security Headers (uncomment and customize as needed)
  # add_header X-Frame-Options "SAMEORIGIN" always;
  # add_header X-XSS-Protection "1; mode=block" always;
  # add_header X-Content-Type-Options "nosniff" always;
  # add_header Referrer-Policy "strict-origin-when-cross-origin" always;
  # add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;" always;
  # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
}
